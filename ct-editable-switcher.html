<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../iron-validatable-behavior/iron-validatable-behavior.html">

<!--
`ct-editable-switcher`
Element to switch between view/edit modes for form inputs on the Centular platform

@demo demo/index.html
-->

<dom-module id="ct-editable-switcher">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
      }

    </style>

    <div hidden$="[[editMode]]" class="text-container">
      <label aria-hidden="true">[[labelVal]]</label>
      <div>[[inputVal]]</div>
    </div>

    <div hidden$="[[!editMode]]" class="input-container">
      <content id="input"></content>
    </div>

  </template>

  <script>
      Polymer({

          is: 'ct-editable-switcher',

          behaviors: [
              Polymer.IronFormElementBehavior,
              Polymer.IronValidatableBehavior
          ],

          properties: {

              inputElem : Object,

              inputVal : String,

              labelVal : String,

              editMode: {
                  type: Boolean,
                  value: function(){ return false },
                  observer: '_editModeChangeHandler'
              }
          },

          attached : function(){

//              async needed to ensure that values are there to be assigned
              this.async(function(){
                  Polymer.dom(this.$.input).observeNodes(function(info) {
                      this.set('inputElem', info.addedNodes[1]);

                      if(this.inputElem.value !== 'on' && this.inputElem.value !== 'off'){
                          this.set('inputVal', this.inputElem.value);
                      } else {
                          var value = (this.inputElem.active) ? 'Yes' : 'No';
                          this.set('inputVal', value);
                      }

                      if(this.inputElem.label){
                          this.set('labelVal', this.inputElem.label);
                      } else {
                          this.set('labelVal', this.inputElem.innerText);
                      }



                  }.bind(this));
              })

          },

          _editModeChangeHandler : function(){
              var inputElem = Polymer.dom(this).getEffectiveChildNodes()[1];

              if(inputElem.value !== 'on' && inputElem.value !== 'off'){
                  this.set('inputVal', inputElem.value);
              } else {
                  var value = (inputElem.active) ? 'Yes' : 'No';
                  this.set('inputVal', value);
              }
          },

          validate : function(){

              if(this.inputElem && this.inputElem.required) {
                  return (this.inputElem.validate())
              } else {
                  return true;
              }
          }
      });

  </script>
</dom-module>
